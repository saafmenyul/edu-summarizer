# CI/CD Документация

## Обзор

Проект использует GitHub Actions для автоматизации тестирования, проверки качества кода и генерации отчетов.

## Триггеры Workflow

### 1. Push и Pull Request
Workflow автоматически запускается при:
- Push в ветки `main` или `develop`
- Создании Pull Request в эти ветки

### 2. Scheduled Workflow (Расписание)
Workflow запускается **каждый день в 00:00 UTC** автоматически.

Это позволяет:
- Регулярно проверять работоспособность проекта
- Генерировать ежедневные отчеты
- Отслеживать изменения в тестах

### 3. Workflow Dispatch (Ручной запуск)

Вы можете вручную запустить workflow с параметрами:

1. Перейдите на вкладку **Actions** в GitHub
2. Выберите workflow **CI/CD Pipeline**
3. Нажмите **Run workflow**
4. Выберите параметры:
   - **test_language**: Язык для тестирования (`en`, `ru`, `de`, или `all`)
   - **python_version**: Версия Python (`3.8`, `3.9`, `3.10`, `3.11`)
5. Нажмите **Run workflow**

## Jobs (Задачи)

### 1. Test
Тестирование на нескольких версиях Python:
- Python 3.8, 3.9, 3.10, 3.11
- Запуск всех unit тестов
- Генерация отчетов о покрытии кода
- **Artifact**: Сохранение результатов тестов (30 дней)

### 2. Test Multilingual
Тестирование с разными языками:
- Английский (en)
- Русский (ru)
- Немецкий (de)
- Поддержка параметров из workflow_dispatch

### 3. Lint
Проверка качества кода:
- **flake8**: Проверка стиля кода (PEP 8)
- **black**: Проверка форматирования
- **mypy**: Проверка типов
- **Artifact**: Сохранение результатов линтинга (7 дней)

### 4. Daily Report (Креативная функция)
Генерация ежедневного отчета:
- Запускается только по расписанию или через workflow_dispatch
- Создает отчет со статистикой проекта
- Включает результаты тестов
- **Artifact**: Сохранение отчета (90 дней)
- **Auto-commit**: Автоматически коммитит отчет в репозиторий (только при scheduled запуске)

## Artifacts (Артефакты)

Все результаты сохраняются как артефакты и доступны для скачивания:

1. Перейдите на вкладку **Actions**
2. Выберите нужный workflow run
3. Прокрутите вниз до секции **Artifacts**
4. Скачайте нужные файлы:
   - `test-results-python-X.X` - результаты тестов для конкретной версии Python
   - `language-test-XX` - результаты тестов для конкретного языка
   - `linting-results` - результаты проверки кода
   - `daily-report-YYYYMMDD` - ежедневный отчет

## Примеры использования

### Запуск тестов для конкретного языка

```yaml
# Через GitHub UI:
# Actions → CI/CD Pipeline → Run workflow
# test_language: ru
# python_version: 3.10
```

### Просмотр ежедневного отчета

1. Дождитесь автоматического запуска (00:00 UTC)
2. Или запустите вручную через workflow_dispatch
3. Скачайте артефакт `daily-report-YYYYMMDD`
4. Или найдите коммит с сообщением "Add daily report YYYYMMDD"

### Просмотр покрытия кода

1. Откройте любой workflow run с job "test"
2. Скачайте артефакт `test-results-python-X.X`
3. Откройте `htmlcov/index.html` в браузере

## Настройка

### Изменение расписания

Отредактируйте `.github/workflows/ci.yml`:

```yaml
schedule:
  - cron: '0 0 * * *'  # Каждый день в 00:00 UTC
  # Формат: 'минута час день месяц день_недели'
  # Примеры:
  # '0 12 * * *' - каждый день в 12:00 UTC
  # '0 0 * * 1' - каждый понедельник в 00:00 UTC
```

### Добавление новых параметров workflow_dispatch

Добавьте в секцию `workflow_dispatch`:

```yaml
workflow_dispatch:
  inputs:
    new_parameter:
      description: 'Описание параметра'
      required: true
      default: 'значение по умолчанию'
      type: string
```

## Troubleshooting

### Workflow не запускается по расписанию

- Убедитесь, что в репозитории есть хотя бы один коммит
- Проверьте синтаксис cron выражения
- GitHub может задерживать scheduled workflows

### Artifacts не сохраняются

- Проверьте, что job завершился успешно
- Убедитесь, что указанные пути существуют
- Максимальный размер артефакта: 10 GB

### Daily report не коммитится

- Проверьте, что workflow запущен через `schedule` (не `workflow_dispatch`)
- Убедитесь, что есть права на запись в репозиторий
- Проверьте логи job "Commit and push report"

